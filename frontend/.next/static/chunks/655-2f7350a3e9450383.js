"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{34936:(e,t,s)=>{s.d(t,{A:()=>g});var r=s(73365),l=s(1521),a=s(91190),c=s.n(a),n=s(85247),o=s(24834),i=s(64427);let d=null,x=null,m=async()=>{if(d&&x&&Date.now()-x<3e5)return d;try{let e=await fetch("/api/companies");if(e.ok)return d=(await e.json()).companies,x=Date.now(),d}catch(e){console.error("Error fetching companies:",e)}return[{companyCode:"PRIMA-SM",name:"PRIMA Sales & Marketing",address:"123 Business Street, City, State - 123456",gstNumber:"12ABCDE1234F1Z5"},{companyCode:"PRIMA-FT",name:"PRIMA Food Trading",address:"456 Trade Avenue, City, State - 123456",gstNumber:"12ABCDE1234F1Z6"},{companyCode:"PRIMA-EX",name:"PRIMA Export",address:"789 Export Road, City, State - 123456",gstNumber:"12ABCDE1234F1Z7"}]},b=async e=>(await m()).find(t=>t.companyCode===e),h=async()=>{let e=await m();return e[0]||e.find(e=>"PRIMA-SM"===e.companyCode)},g=e=>{var t,s,a,d,x;let{sale:m,onClose:g}=e,[u,p]=(0,l.useState)(!1),[j,y]=(0,l.useState)(null),v=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=(null==m?void 0:m.companyId)||"PRIMA-SM",t=await b(e);y(t)}catch(e){console.error("Error fetching company details:",e),y(await h())}})()},[m]),(0,l.useEffect)(()=>{m&&j&&!u&&(p(!0),setTimeout(()=>{N()},1e3))},[m,j]);let N=async()=>{if(v.current&&m)try{console.log("Starting PDF generation...");let e=await c()(v.current,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",width:794,height:v.current.scrollHeight,logging:!0,removeContainer:!1,scrollX:0,scrollY:0,windowWidth:794,windowHeight:v.current.scrollHeight,foreignObjectRendering:!1,imageTimeout:15e3});console.log("Canvas created, generating PDF...");let t=e.toDataURL("image/png"),s=new n.Ay("p","mm","a4"),r=210*e.height/e.width,l=r,a=0;for(s.addImage(t,"PNG",0,a,210,r),l-=295;l>=0;)a=l-r,s.addPage(),s.addImage(t,"PNG",0,a,210,r),l-=295;console.log("PDF created, saving..."),s.save("Invoice-".concat(m.invoiceNumber,".pdf")),console.log("PDF saved successfully"),p(!1),g&&g()}catch(e){console.error("Error generating PDF:",e),alert("Failed to generate PDF. Please try again."),p(!1),g&&g()}};if(!m)return null;let f=(0,i.Um)(m.items);return(0,r.jsxs)("div",{className:"fixed inset-0 z-50 bg-white flex items-center justify-center",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-700",children:"Generating PDF..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Please wait while we prepare your invoice"})]}),(0,r.jsxs)("div",{ref:v,className:"bg-white p-8 border border-gray-300 text-black",style:{position:"absolute",left:"0",top:"0",width:"794px",fontFamily:"Arial, sans-serif",fontSize:"12px",lineHeight:"1.4",color:"#000000",visibility:"visible",display:"block",zIndex:"9999"},children:[(0,r.jsx)("div",{className:"border-b-2 border-gray-300 pb-6 mb-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-black mb-2",children:"TAX INVOICE"}),(0,r.jsxs)("div",{className:"text-sm text-black",children:[(0,r.jsxs)("p",{className:"text-black",children:[(0,r.jsx)("strong",{children:"Invoice No:"})," ",m.invoiceNumber]}),(0,r.jsxs)("p",{className:"text-black",children:[(0,r.jsx)("strong",{children:"Date:"})," ",m.invoiceDate?new Date(m.invoiceDate).toLocaleDateString():"Invalid Date"]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-black mb-2 max-w-xs break-words",children:(null==j?void 0:j.name)||"Prima Sales & Marketing Pvt Ltd"}),(0,r.jsxs)("div",{className:"text-sm text-black",children:[(0,r.jsx)("p",{className:"max-w-xs break-words",children:(null==j?void 0:j.address)||"123 Business Street, City, State - 123456"}),(0,r.jsxs)("p",{className:"text-black",children:["GSTIN: ",(null==j?void 0:j.gstNumber)||"12ABCDE1234F1Z5"]})]})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-black mb-3 border-b border-gray-300 pb-1",children:"Bill To:"}),(0,r.jsxs)("div",{className:"text-sm text-black",children:[(0,r.jsx)("p",{className:"font-semibold text-black",children:null==(t=m.customerDetails)?void 0:t.shopName}),(0,r.jsx)("p",{className:"text-black",children:null==(s=m.customerDetails)?void 0:s.name}),(0,r.jsx)("p",{className:"text-black",children:null==(a=m.customerDetails)?void 0:a.phone}),(0,r.jsx)("p",{className:"whitespace-pre-line text-black max-w-xs break-words",children:null==(d=m.customerDetails)?void 0:d.address})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-black mb-3 border-b border-gray-300 pb-1",children:"Invoice Summary:"}),(0,r.jsxs)("div",{className:"text-sm space-y-1 text-black",children:[(0,r.jsxs)("div",{className:"flex justify-between text-black",children:[(0,r.jsx)("span",{className:"text-black",children:"Subtotal:"}),(0,r.jsx)("span",{className:"text-black",children:(0,o.vv)(m.subtotal)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-black",children:[(0,r.jsx)("span",{className:"text-black",children:"Total GST:"}),(0,r.jsx)("span",{className:"text-black",children:(0,o.vv)(m.totalGST)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-black",children:[(0,r.jsx)("span",{className:"text-black",children:"Invoice Value:"}),(0,r.jsx)("span",{className:"text-black",children:(0,o.vv)(m.invoiceValue)})]}),m.discount>0&&(0,r.jsxs)("div",{className:"flex justify-between text-black",children:[(0,r.jsx)("span",{className:"text-black",children:"Discount:"}),(0,r.jsxs)("span",{className:"text-black",children:["-",(0,o.vv)(m.discount)]})]}),(0,r.jsxs)("div",{className:"flex justify-between font-bold text-lg border-t pt-1 text-black",children:[(0,r.jsx)("span",{className:"text-black",children:"Final Amount:"}),(0,r.jsx)("span",{className:"text-black",children:(0,o.vv)(m.finalAmount)})]})]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-black mb-3 border-b border-gray-300 pb-1",children:"Item Details:"}),(0,r.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-bold text-black",children:"S.No"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-bold text-black",children:"Product Description"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-bold text-black",children:"HSN Code"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-bold text-black",children:"Qty"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-bold text-black",children:"Unit"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-right text-sm font-bold text-black",children:"Rate (₹)"}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-right text-sm font-bold text-black",children:"Amount (₹)"}),(0,r.jsxs)("th",{className:"border border-gray-300 px-3 py-2 text-right text-sm font-bold text-black",children:["GST (",(null==(x=m.items[0])?void 0:x.gstRate)||5,"%)"]}),(0,r.jsx)("th",{className:"border border-gray-300 px-3 py-2 text-right text-sm font-bold text-black",children:"Total (₹)"})]})}),(0,r.jsx)("tbody",{children:m.items.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-black",children:t+1}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-black max-w-xs break-words",children:e.product}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-black",children:e.hsnCode||"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-black",children:e.qty}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-center text-black",children:e.unit||"-"}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-right text-black",children:(0,o.vv)(e.rate)}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-right text-black",children:(0,o.vv)(e.taxableValue)}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-right text-black",children:(0,o.vv)(e.gst)}),(0,r.jsx)("td",{className:"border border-gray-300 px-3 py-2 text-sm text-right font-medium text-black",children:(0,o.vv)(e.invoiceValue)})]},t))})]})]}),Object.keys(f).length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-black mb-3 border-b border-gray-300 pb-1",children:"GST Breakdown:"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(f).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"border border-gray-300 p-3",children:[(0,r.jsxs)("div",{className:"text-sm font-bold text-black",children:[t,"% GST"]}),(0,r.jsxs)("div",{className:"text-xs text-black",children:["Taxable: ",(0,o.vv)(s.taxableAmount)]}),(0,r.jsxs)("div",{className:"text-sm font-medium text-black",children:["Tax: ",(0,o.vv)(s.gstAmount)]})]},t)})})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-black mb-3 border-b border-gray-300 pb-1",children:"Terms & Conditions:"}),(0,r.jsxs)("div",{className:"text-sm text-black space-y-1",children:[(0,r.jsx)("p",{className:"text-black",children:"• Payment is due within 30 days of invoice date"}),(0,r.jsx)("p",{className:"text-black",children:"• Goods once sold will not be taken back"}),(0,r.jsx)("p",{className:"text-black",children:"• Interest will be charged on overdue payments"}),(0,r.jsx)("p",{className:"text-black",children:"• Subject to local jurisdiction"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-8 mt-8",children:[(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"border-t-2 border-gray-300 pt-4",children:(0,r.jsx)("p",{className:"text-sm font-bold text-black",children:"Customer Signature"})})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"border-t-2 border-gray-300 pt-4",children:(0,r.jsx)("p",{className:"text-sm font-bold text-black",children:"Authorized Signature"})})})]}),(null==m?void 0:m.notes)&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 border border-gray-300",children:[(0,r.jsx)("h4",{className:"font-bold text-black mb-2",children:"Notes:"}),(0,r.jsx)("p",{className:"text-sm text-black",children:m.notes})]})]})]})}},79456:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(73365),l=s(1521);let a=e=>{let{isOpen:t,onClose:s,title:a,message:c,children:n,type:o="info",showCloseButton:i=!0,onConfirm:d,confirmText:x="OK",cancelText:m="Cancel",showCancelButton:b=!1,size:h="md"}=e;if((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&s()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,s]),!t)return null;let g=(()=>{switch(o){case"success":return{icon:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),iconBg:"bg-green-100",iconColor:"text-green-600",titleColor:"text-green-800",borderColor:"border-green-200"};case"error":return{icon:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),iconBg:"bg-red-100",iconColor:"text-red-600",titleColor:"text-red-800",borderColor:"border-red-200"};case"warning":return{icon:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),iconBg:"bg-yellow-100",iconColor:"text-yellow-600",titleColor:"text-yellow-800",borderColor:"border-yellow-200"};default:return{icon:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),iconBg:"bg-blue-100",iconColor:"text-blue-600",titleColor:"text-blue-800",borderColor:"border-blue-200"}}})(),u=(()=>{switch(h){case"sm":return"max-w-md";case"lg":return"max-w-2xl";default:return"max-w-lg"}})(),p=()=>{s()};return(0,r.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:s}),(0,r.jsx)("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full ".concat(u),children:(0,r.jsxs)("div",{className:"border-l-4 ".concat(g.borderColor),children:[(0,r.jsx)("div",{className:"px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,r.jsxs)("div",{className:"sm:flex sm:items-start",children:[(0,r.jsx)("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10 ".concat(g.iconBg),children:(0,r.jsx)("div",{className:g.iconColor,children:g.icon})}),(0,r.jsxs)("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:[a&&(0,r.jsx)("h3",{className:"text-lg font-medium leading-6 ".concat(g.titleColor," mb-4"),children:a}),n?(0,r.jsx)("div",{className:"mt-2",children:n}):(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:c})})]})]})}),!n&&(0,r.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[(0,r.jsx)("button",{type:"button",className:"inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm sm:ml-3 sm:w-auto ".concat("success"===o?"bg-green-600 hover:bg-green-500":"error"===o?"bg-red-600 hover:bg-red-500":"warning"===o?"bg-yellow-600 hover:bg-yellow-500":"bg-blue-600 hover:bg-blue-500"),onClick:()=>{d&&d(),s()},children:x}),b&&(0,r.jsx)("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:p,children:m}),i&&!b&&(0,r.jsx)("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:p,children:"Close"})]})]})})]})})}}}]);