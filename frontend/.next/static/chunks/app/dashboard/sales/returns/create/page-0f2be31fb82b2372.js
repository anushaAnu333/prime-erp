(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[139],{11193:(e,t,a)=>{"use strict";a.d(t,{default:()=>u});var r=a(73365),s=a(1521),l=a(1702),n=a(34467),o=a(21071),i=a(41633),c=a(57353),d=a(64427);function u(){let e=(0,l.useRouter)(),[t,a]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),[x,g]=(0,s.useState)([]),[b,p]=(0,s.useState)(null),[h,y]=(0,s.useState)([{product:"",expiryDate:"",qty:"",rate:"",unit:"",taxableValue:0,gst:0,invoiceValue:0}]),[f,v]=(0,s.useState)({taxableValue:0,gst:0,invoiceValue:0,total:0}),[j,N]=(0,s.useState)([]),w=["kg","packet","piece","dozen","box"];(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/products");if(e.ok){let t=await e.json();N(t.products||[])}}catch(e){console.error("Error fetching products:",e)}})()},[]);let S=e=>j.find(t=>t.name.toLowerCase()===e.toLowerCase()),[C,k]=(0,s.useState)({date:new Date().toISOString().split("T")[0],againstSaleId:"",customerName:"",companyId:"PRIMA-SM",discount:0});(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/sales?type=Sale&limit=100");if(e.ok){let t=await e.json();g(t.sales||[])}}catch(e){console.error("Error fetching sales:",e)}})()},[]);let A=(e,t)=>{k(a=>({...a,[e]:t}))},I=async e=>{if(A("againstSaleId",e),e)try{let t=await fetch("/api/sales/".concat(e));if(t.ok){let e=await t.json();p(e),k(t=>({...t,customerName:e.customerName,companyId:e.companyId}));let a=e.items.map(e=>({product:e.product.toLowerCase(),expiryDate:new Date(e.expiryDate).toISOString().split("T")[0],qty:e.qty.toString(),rate:e.rate.toString(),unit:e.unit||"",taxableValue:e.taxableValue,gst:e.gst,invoiceValue:e.invoiceValue}));y(a)}}catch(e){console.error("Error fetching sale details:",e)}else p(null),y([{product:"",expiryDate:"",qty:"",rate:"",unit:"",taxableValue:0,gst:0,invoiceValue:0}])},q=(e,t,a)=>{let r=[...h];if(r[e]={...r[e],[t]:a},"qty"===t||"rate"===t){let t=parseFloat(r[e].qty)||0,a=parseFloat(r[e].rate)||0,s=r[e].product;if(s&&t&&a){let l=(0,d.Rf)(s,t,a,r[e].expiryDate);r[e]={...r[e],taxableValue:l.taxableValue,gst:l.gst,invoiceValue:l.invoiceValue}}}y(r)},V=async e=>{e.preventDefault(),a(!0),m("");try{let e={againstSaleId:C.againstSaleId,customerName:C.customerName,companyId:C.companyId,items:h.map(e=>{var t;return{product:e.product.toLowerCase(),expiryDate:e.expiryDate,qty:parseFloat(e.qty),rate:parseFloat(e.rate),unit:e.unit,hsnCode:(null==(t=S(e.product))?void 0:t.hsnCode)||""}}),discount:parseFloat(C.discount)||0},t=await fetch("/api/sales/returns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)await t.json(),alert("Sales return created successfully!"),k({date:new Date().toISOString().split("T")[0],againstSaleId:"",customerName:"",companyId:"PRIMA-SM",discount:0}),y([{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}]),v({taxableValue:0,gst:0,invoiceValue:0,total:0}),p(null);else{let e=await t.json();m(e.error||"Failed to create sales return")}}catch(e){console.error("Error creating sales return:",e),m("Failed to create sales return")}finally{a(!1)}};return(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)(n.A,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Create Sales Return"}),u&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-red-600",children:u})}),(0,r.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Number"}),(0,r.jsx)(o.A,{value:"Auto-generated",disabled:!0,className:"bg-gray-50"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,r.jsx)(o.A,{type:"date",value:C.date,onChange:e=>A("date",e.target.value),required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Against Sale"}),(0,r.jsx)(c.A,{placeholder:"Select Original Sale",options:x.map(e=>({value:e._id,label:"".concat(e.invoiceNo," - ").concat(e.customerName)})),value:C.againstSaleId,onChange:I,required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Name"}),(0,r.jsx)(o.A,{value:C.customerName,onChange:e=>A("customerName",e.target.value),required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company"}),(0,r.jsx)(c.A,{options:[{value:"PRIMA-SM",label:"PRIMA-SM"},{value:"PRIMA-FT",label:"PRIMA-FT"},{value:"PRIMA-EX",label:"PRIMA-EX"}],value:C.companyId,onChange:e=>A("companyId",e),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Return Items"}),(0,r.jsx)(i.A,{type:"button",onClick:()=>{y([...h,{product:"",expiryDate:"",qty:"",rate:"",unit:"",taxableValue:0,gst:0,invoiceValue:0}])},variant:"outline",children:"Add Item"})]}),(0,r.jsx)("div",{className:"space-y-4",children:h.map((e,t)=>{var a;return(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-8 gap-4 p-4 border border-gray-200 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product"}),(0,r.jsx)(o.A,{value:e.product,onChange:e=>q(t,"product",e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HSN Code"}),(0,r.jsx)(o.A,{value:(null==(a=S(e.product))?void 0:a.hsnCode)||"",disabled:!0,className:"bg-gray-50",placeholder:"HSN Code"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),(0,r.jsx)(o.A,{type:"date",value:e.expiryDate,onChange:e=>q(t,"expiryDate",e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity"}),(0,r.jsx)(o.A,{type:"number",step:"0.01",value:e.qty,onChange:e=>q(t,"qty",e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),(0,r.jsx)(c.A,{options:w.map(e=>({value:e,label:e})),value:e.unit,onChange:e=>q(t,"unit",e),placeholder:"Unit",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rate"}),(0,r.jsx)(o.A,{type:"number",step:"0.01",value:e.rate,onChange:e=>q(t,"rate",e.target.value),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total"}),(0,r.jsx)(o.A,{value:e.invoiceValue.toFixed(2),disabled:!0,className:"bg-gray-50"})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)(i.A,{type:"button",onClick:()=>{h.length>1&&y(h.filter((e,a)=>a!==t))},variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50",disabled:1===h.length,children:"Remove"})})]},t)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount (%)"}),(0,r.jsx)(o.A,{type:"number",step:"0.01",value:C.discount,onChange:e=>A("discount",e.target.value)})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(i.A,{type:"button",onClick:()=>e.back(),variant:"outline",children:"Cancel"}),(0,r.jsx)(i.A,{type:"submit",disabled:t,children:t?"Creating...":"Create Return"})]})]})]})})}},21071:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(73365);a(1521);let s=e=>{let{type:t="text",label:a,placeholder:s,value:l,onChange:n,onBlur:o,onFocus:i,error:c,success:d,disabled:u=!1,required:m=!1,readOnly:x=!1,className:g="",size:b="md",fullWidth:p=!0,icon:h,iconPosition:y="left",helperText:f,...v}=e,j=["block w-full border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-0 text-gray-900 placeholder-gray-500",{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-4 py-3 text-base"}[b],{default:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",error:"border-red-300 focus:border-red-500 focus:ring-red-500",success:"border-green-300 focus:border-green-500 focus:ring-green-500"}[c?"error":d?"success":"default"],u?"bg-gray-50 cursor-not-allowed text-gray-500":"bg-white",p?"w-full":"",h&&"left"===y?"pl-10":"",h&&"right"===y?"pr-10":"",g].filter(Boolean).join(" ");return(0,r.jsxs)("div",{className:"".concat(p?"w-full":""),children:[a&&(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a,m&&(0,r.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[h&&"left"===y&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("span",{className:"text-gray-400",children:h})}),(0,r.jsx)("input",{type:t,className:j,placeholder:s,value:l,onChange:n,onBlur:o,onFocus:i,disabled:u,required:m,readOnly:x,...v}),h&&"right"===y&&(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,r.jsx)("span",{className:"text-gray-400",children:h})})]}),c&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:c}),d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-green-600",children:d}),f&&!c&&!d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:f})]})}},57353:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(73365),s=a(1521);let l=e=>{let{options:t=[],value:a,onChange:l,placeholder:n="Select an option",searchable:o=!1,loading:i=!1,disabled:c=!1,error:d=!1,onSearch:u=null,displayKey:m="label",valueKey:x="value",className:g=""}=e,[b,p]=(0,s.useState)(!1),[h,y]=(0,s.useState)(""),f=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&(p(!1),y(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let v=o&&h?t.filter(e=>e[m].toLowerCase().includes(h.toLowerCase())):t;return(0,r.jsxs)("div",{className:"relative ".concat(g),ref:f,children:[(0,r.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),!c&&(p(!b),b||y(""))},disabled:c,className:"\n          w-full px-3 py-2.5 text-left border rounded-lg shadow-sm bg-white text-gray-900\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed\n          ".concat(d?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300","\n          ").concat(b?"ring-2 ring-blue-500 border-blue-500":"","\n        "),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"".concat(a?"text-gray-900":"text-gray-500"," truncate text-sm flex-1 min-w-0"),children:(()=>{let e=t.find(e=>e[x]===a);return e?e[m]:n})()}),(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(b?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),b&&(0,r.jsxs)("div",{className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden",children:[o&&(0,r.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,r.jsx)("input",{type:"text",value:h,onChange:e=>{let t=e.target.value;y(t),u&&u(t)},placeholder:"Search...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})}),(0,r.jsx)("div",{className:"max-h-48 overflow-y-auto",children:i?(0,r.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Loading..."}):0===v.length?(0,r.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:h?"No options found":"No options available"}):v.map((e,t)=>(0,r.jsx)("button",{type:"button",onClick:t=>((e,t)=>{t.preventDefault(),t.stopPropagation(),l&&"function"==typeof l&&l(e[x]),p(!1),y("")})(e,t),className:"\n                    w-full px-3 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none cursor-pointer\n                    ".concat(e[x]===a?"bg-blue-50 text-blue-900":"text-gray-900","\n                  "),children:e[m]},e[x]||t))})]})]})}},97584:(e,t,a)=>{Promise.resolve().then(a.bind(a,11193))}},e=>{e.O(0,[96,541,358],()=>e(e.s=97584)),_N_E=e.O()}]);