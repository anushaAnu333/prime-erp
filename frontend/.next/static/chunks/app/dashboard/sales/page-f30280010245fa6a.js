(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{21071:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(73365);a(1521);let r=e=>{let{type:t="text",label:a,placeholder:r,value:l,onChange:n,onBlur:o,onFocus:i,error:c,success:d,disabled:u=!1,required:m=!1,readOnly:x=!1,className:g="",size:h="md",fullWidth:p=!0,icon:y,iconPosition:b="left",helperText:v,...f}=e,j=["block w-full border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-0 text-gray-900 placeholder-gray-500",{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-4 py-3 text-base"}[h],{default:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",error:"border-red-300 focus:border-red-500 focus:ring-red-500",success:"border-green-300 focus:border-green-500 focus:ring-green-500"}[c?"error":d?"success":"default"],u?"bg-gray-50 cursor-not-allowed text-gray-500":"bg-white",p?"w-full":"",y&&"left"===b?"pl-10":"",y&&"right"===b?"pr-10":"",g].filter(Boolean).join(" ");return(0,s.jsxs)("div",{className:"".concat(p?"w-full":""),children:[a&&(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a,m&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[y&&"left"===b&&(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400",children:y})}),(0,s.jsx)("input",{type:t,className:j,placeholder:r,value:l,onChange:n,onBlur:o,onFocus:i,disabled:u,required:m,readOnly:x,...f}),y&&"right"===b&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400",children:y})})]}),c&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:c}),d&&(0,s.jsx)("p",{className:"mt-1 text-sm text-green-600",children:d}),v&&!c&&!d&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:v})]})}},26872:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var s=a(73365),r=a(1521),l=a(41633),n=a(21071),o=a(57353),i=a(34467),c=a(85299),d=a(18197),u=a.n(d);let m=e=>{let{dateFrom:t,dateTo:a,onDateChange:o}=e,[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(t),[m,x]=(0,r.useState)(a),g=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,r.useEffect)(()=>{u(t),x(a)},[t,a]),(0,s.jsxs)("div",{className:"relative",ref:g,children:[(0,s.jsx)("button",{type:"button",onClick:()=>c(!i),className:"w-full px-3 py-2.5 text-left border border-gray-300 rounded-lg shadow-sm bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"".concat(t||a?"text-gray-900":"text-gray-500"," truncate text-sm"),children:t&&a?"".concat(t," to ").concat(a):t?"From ".concat(t):a?"To ".concat(a):"Date Range"}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(i?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),i&&(0,s.jsx)("div",{className:"absolute z-50 w-80 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),(0,s.jsx)(n.A,{type:"date",value:d,onChange:e=>u(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),(0,s.jsx)(n.A,{type:"date",value:m,onChange:e=>x(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,s.jsx)(l.A,{type:"button",onClick:()=>{o("dateFrom",d),o("dateTo",m),c(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 text-sm",children:"Apply"}),(0,s.jsx)(l.A,{type:"button",onClick:()=>{u(""),x(""),o("dateFrom",""),o("dateTo",""),c(!1)},className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 text-sm",children:"Clear"})]})]})})]})};function x(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)([]),[d,x]=(0,r.useState)([{value:"",label:"All Companies"},{value:"PRIMA-SM",label:"PRIMA Sales & Marketing"},{value:"PRIMA-FT",label:"PRIMA Food Trading"},{value:"PRIMA-EX",label:"PRIMA Export"}]),[g,h]=(0,r.useState)({customer:"",company:"",dateFrom:"",dateTo:"",paymentStatus:"",deliveryStatus:"",type:"Sale"}),[p,y]=(0,r.useState)({page:1,total:0,totalPages:0}),[b,v]=(0,r.useState)(!1);(0,r.useEffect)(()=>{f(),j()},[g,p.page]);let f=async()=>{v(!0);try{let e=new URLSearchParams({page:p.page.toString(),limit:"20",type:g.type,...g.customer&&{customer:g.customer},...g.company&&{company:g.company},...g.dateFrom&&{dateFrom:g.dateFrom},...g.dateTo&&{dateTo:g.dateTo},...g.paymentStatus&&{paymentStatus:g.paymentStatus},...g.deliveryStatus&&{deliveryStatus:g.deliveryStatus}}),a=await fetch("/api/sales?".concat(e));if(a.ok){let e=await a.json();t(e.sales||[]),y(t=>({...t,total:e.total||0,totalPages:e.totalPages||0}))}else{let e=await a.json();console.error("Sales API error:",e)}}catch(e){console.error("Error fetching sales:",e)}finally{v(!1)}},j=async()=>{try{let e=await fetch("/api/customers");if(e.ok){let t=await e.json();n([{value:"",label:"All Customers"},...(t.customers||[]).map(e=>({value:e.shopName,label:e.shopName}))])}}catch(e){console.error("Error fetching customers:",e)}},N=(e,t)=>{h(a=>({...a,[e]:t})),y(e=>({...e,page:1}))},w=e=>{y(t=>({...t,page:e}))},S=(e,t)=>{let a=e||"Pending",r={payment:{Pending:"bg-yellow-100 text-yellow-800",Paid:"bg-green-100 text-green-800",Partial:"bg-blue-100 text-blue-800"},delivery:{Pending:"bg-yellow-100 text-yellow-800",Delivered:"bg-green-100 text-green-800",Cancelled:"bg-red-100 text-red-800"}},l=r[t]||r.payment;return(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(l[a]||"bg-gray-100 text-gray-800"),children:a})},A=[{key:"invoiceNumber",header:"Sale Return"===g.type?"Return No":"Invoice No",render:(e,t)=>(0,s.jsx)(u(),{href:"/dashboard/sales/".concat(t._id),className:"text-blue-600 hover:text-blue-800 font-medium",children:e})},{key:"invoiceDate",header:"Date",render:e=>new Date(e).toLocaleDateString("en-IN")},{key:"customer",header:"Customer",render:(e,t)=>"Sale Return"===g.type&&t.originalSale?(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:e.shopName}),(0,s.jsxs)("div",{className:"text-gray-500 text-xs",children:["Against: ",t.originalSale.invoiceNumber]})]}):(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:e.shopName}),(0,s.jsx)("div",{className:"text-gray-500 text-xs",children:e.name})]})},{key:"items",header:"Products",render:(e,t)=>{if(e&&e.length>0)if(1===e.length)return(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:e[0].product}),(0,s.jsxs)("div",{className:"text-gray-500 text-xs",children:["Qty: ",e[0].qty," \xd7 â‚¹",e[0].rate]})]});else return(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("div",{className:"font-medium",children:[e.length," Products"]}),(0,s.jsxs)("div",{className:"text-gray-500 text-xs",children:[e.slice(0,2).map(e=>"".concat(e.product," (").concat(e.qty,")")).join(", "),e.length>2&&" +".concat(e.length-2," more")]})]});return"N/A"}},{key:"finalAmount",header:"Amount",render:e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(e)},{key:"paymentStatus",header:"Payment",render:e=>S(e,"payment")},{key:"deliveryStatus",header:"Delivery",render:e=>S(e,"delivery")},{key:"actions",header:"Actions",render:(e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(u(),{href:"/dashboard/sales/".concat(t._id),children:(0,s.jsx)(l.A,{size:"sm",variant:"outline",children:"View"})}),(0,s.jsx)(u(),{href:"/dashboard/sales/edit/".concat(t._id),children:(0,s.jsx)(l.A,{size:"sm",variant:"outline",children:"Edit"})})]})}];return(0,s.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,s.jsxs)(i.A,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Sale"===g.type?"Sales Invoices":"Sales Returns"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(u(),{href:"/dashboard/sales/create",children:(0,s.jsx)(l.A,{className:"bg-blue-600 hover:bg-blue-700",children:"Create Sales Invoice"})}),(0,s.jsx)(u(),{href:"/dashboard/sales/returns/create",children:(0,s.jsx)(l.A,{className:"bg-red-600 hover:bg-red-700",children:"Create Sales Return"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 lg:grid-cols-7 gap-4 mb-6",children:[(0,s.jsx)(o.A,{placeholder:"Select Customer",options:a,value:g.customer,onChange:e=>N("customer",e)}),(0,s.jsx)(o.A,{placeholder:"Select Company",options:d,value:g.company,onChange:e=>N("company",e)}),(0,s.jsx)(m,{dateFrom:g.dateFrom,dateTo:g.dateTo,onDateChange:(e,t)=>N(e,t)}),(0,s.jsx)(o.A,{placeholder:"Payment",options:[{value:"",label:"All Payments"},{value:"Pending",label:"Pending"},{value:"Paid",label:"Paid"},{value:"Partial",label:"Partial"}],value:g.paymentStatus,onChange:e=>N("paymentStatus",e)}),(0,s.jsx)(o.A,{placeholder:"Delivery",options:[{value:"",label:"All Deliveries"},{value:"Pending",label:"Pending"},{value:"Delivered",label:"Delivered"},{value:"Cancelled",label:"Cancelled"}],value:g.deliveryStatus,onChange:e=>N("deliveryStatus",e)}),(0,s.jsx)(o.A,{options:[{value:"Sale",label:"Sales"},{value:"Sale Return",label:"Returns"}],value:g.type,onChange:e=>N("type",e)})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)(c.A,{data:e,columns:A,loading:b,emptyMessage:"Sale"===g.type?"No sales invoices found":"No sales returns found"})}),p.totalPages>1&&(0,s.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing page ",p.page," of ",p.totalPages," (",p.total," total)"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.A,{variant:"outline",disabled:1===p.page,onClick:()=>w(p.page-1),children:"Previous"}),(0,s.jsx)(l.A,{variant:"outline",disabled:p.page===p.totalPages,onClick:()=>w(p.page+1),children:"Next"})]})]})]})})}function g(){return(0,s.jsx)(x,{})}},57353:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(73365),r=a(1521);let l=e=>{let{options:t=[],value:a,onChange:l,placeholder:n="Select an option",searchable:o=!1,loading:i=!1,disabled:c=!1,error:d=!1,onSearch:u=null,displayKey:m="label",valueKey:x="value",className:g=""}=e,[h,p]=(0,r.useState)(!1),[y,b]=(0,r.useState)(""),v=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{v.current&&!v.current.contains(e.target)&&(p(!1),b(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=o&&y?t.filter(e=>e[m].toLowerCase().includes(y.toLowerCase())):t;return(0,s.jsxs)("div",{className:"relative ".concat(g),ref:v,children:[(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),!c&&(p(!h),h||b(""))},disabled:c,className:"\n          w-full px-3 py-2.5 text-left border rounded-lg shadow-sm bg-white text-gray-900\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed\n          ".concat(d?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300","\n          ").concat(h?"ring-2 ring-blue-500 border-blue-500":"","\n        "),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"".concat(a?"text-gray-900":"text-gray-500"," truncate text-sm flex-1 min-w-0"),children:(()=>{let e=t.find(e=>e[x]===a);return e?e[m]:n})()}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(h?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),h&&(0,s.jsxs)("div",{className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden",children:[o&&(0,s.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,s.jsx)("input",{type:"text",value:y,onChange:e=>{let t=e.target.value;b(t),u&&u(t)},placeholder:"Search...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})}),(0,s.jsx)("div",{className:"max-h-48 overflow-y-auto",children:i?(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Loading..."}):0===f.length?(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:y?"No options found":"No options available"}):f.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:t=>((e,t)=>{t.preventDefault(),t.stopPropagation(),l&&"function"==typeof l&&l(e[x]),p(!1),b("")})(e,t),className:"\n                    w-full px-3 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none cursor-pointer\n                    ".concat(e[x]===a?"bg-blue-50 text-blue-900":"text-gray-900","\n                  "),children:e[m]},e[x]||t))})]})]})}},61276:(e,t,a)=>{Promise.resolve().then(a.bind(a,26872))}},e=>{e.O(0,[96,29,358],()=>e(e.s=61276)),_N_E=e.O()}]);