(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[604],{12622:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(73365),l=a(1521),r=a(1702),n=a(34467),o=a(41633),c=a(21071);function i(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),[a,i]=(0,l.useState)(null),[d,m]=(0,l.useState)([]),[u,x]=(0,l.useState)([]),[g,h]=(0,l.useState)(!0),[b,p]=(0,l.useState)(!1),[f,y]=(0,l.useState)(""),j=[{id:"agent1",name:"Amit Singh",company:"PRIMA-SM"},{id:"agent2",name:"Vikram Patel",company:"PRIMA-SM"},{id:"agent3",name:"Rajesh Kumar",company:"PRIMA-FT"},{id:"agent4",name:"Suresh Sharma",company:"PRIMA-FT"}];(0,l.useEffect)(()=>{N()},[]);let N=async()=>{try{let t=await fetch("/api/stock/".concat(e.id));if(t.ok){let e=await t.json();i(e.stock);let a=j.filter(t=>t.company===e.stock.companyId);m(a),x(a.map(e=>({agentId:e.id,agentName:e.name,quantity:0})))}}catch(e){console.error("Error fetching stock data:",e),y("Failed to fetch stock data")}finally{h(!1)}},v=()=>u.reduce((e,t)=>e+(parseFloat(t.quantity)||0),0),k=()=>a?a.closingStock-v():0,w=()=>{let e=v();return e<=(null==a?void 0:a.closingStock)&&e>0},S=async()=>{if(!w())return void y("Invalid allocation. Check quantities and available stock.");p(!0),y("");try{let a=await fetch("/api/stock/allocate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stockId:e.id,allocations:u.filter(e=>e.quantity>0)})});if(a.ok)await a.json(),alert("Stock allocated successfully!"),t.push("/dashboard/stock");else{let e=await a.json();y(e.message||"Failed to allocate stock")}}catch(e){console.error("Error allocating stock:",e),y("Failed to allocate stock")}finally{p(!1)}},A=e=>{if(!a)return;let t=[];switch(e){case"equal":let s=Math.floor(a.closingStock/d.length);t=d.map(e=>({agentId:e.id,agentName:e.name,quantity:s}));break;case"pattern":let l=[1e3,2e3,2500];t=d.map((e,t)=>({agentId:e.id,agentName:e.name,quantity:l[t]||Math.floor(a.closingStock/d.length)}));break;case"proportional":let r=a.closingStock,n=[.2,.3,.25,.25];t=d.map((e,t)=>({agentId:e.id,agentName:e.name,quantity:Math.floor(r*n[t])}))}x(t)};return g?(0,s.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,s.jsx)(n.A,{className:"p-6",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,s.jsx)("div",{className:"space-y-3",children:[1,2,3,4].map(e=>(0,s.jsx)("div",{className:"h-12 bg-gray-200 rounded"},e))})]})})}):a?(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Allocate Stock to Agents"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Allocate stock from ",a.product," (",a.companyId,") to delivery agents"]})]}),(0,s.jsxs)(n.A,{className:"mb-6 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Stock Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Product"}),(0,s.jsx)("p",{className:"text-lg font-semibold capitalize",children:a.product})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Company"}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:a.companyId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Available Stock"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:[a.closingStock.toLocaleString()," ",a.unit]})]})]})]}),(0,s.jsxs)(n.A,{className:"mb-6 p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Quick Allocation Presets"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsx)(o.A,{variant:"outline",onClick:()=>A("equal"),disabled:!a||0===a.closingStock,children:"Equal Distribution"}),(0,s.jsx)(o.A,{variant:"outline",onClick:()=>A("pattern"),disabled:!a||0===a.closingStock,children:"Pattern (1000, 2000, 2500)"}),(0,s.jsx)(o.A,{variant:"outline",onClick:()=>A("proportional"),disabled:!a||0===a.closingStock,children:"Proportional"})]})]}),(0,s.jsxs)(n.A,{className:"mb-6 p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Agent Allocations"}),f&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:f}),(0,s.jsx)("div",{className:"space-y-4",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.agentName}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Agent ID: ",e.agentId]})]}),(0,s.jsx)("div",{className:"w-32",children:(0,s.jsx)(c.A,{type:"number",min:"0",max:a.closingStock,value:e.quantity,onChange:e=>((e,t,a)=>{let s=[...u];s[e]={...s[e],[t]:a},x(s)})(t,"quantity",e.target.value),placeholder:"Quantity"})}),(0,s.jsx)("div",{className:"w-20 text-sm text-gray-500",children:a.unit})]},e.agentId))}),(0,s.jsx)("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Total Allocated"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:[v().toLocaleString()," ",a.unit]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Remaining Stock"}),(0,s.jsxs)("p",{className:"text-lg font-semibold ".concat(0>k()?"text-red-600":"text-green-600"),children:[k().toLocaleString()," ",a.unit]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,s.jsx)("p",{className:"text-lg font-semibold ".concat(0>k()?"text-red-600":0===k()?"text-green-600":"text-yellow-600"),children:0>k()?"Over-allocated":0===k()?"Fully allocated":"Partially allocated"})]})]})})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(o.A,{onClick:S,disabled:!w()||b,className:"flex-1",children:b?"Allocating...":"Allocate Stock"}),(0,s.jsx)(o.A,{variant:"outline",onClick:()=>t.push("/dashboard/stock"),children:"Cancel"})]})]}):(0,s.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,s.jsx)(n.A,{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Stock Not Found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"The requested stock could not be found."}),(0,s.jsx)(o.A,{onClick:()=>t.push("/dashboard/stock"),children:"Back to Stock Dashboard"})]})})})}a(57353)},20900:(e,t,a)=>{Promise.resolve().then(a.bind(a,12622))},21071:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(73365);a(1521);let l=e=>{let{type:t="text",label:a,placeholder:l,value:r,onChange:n,onBlur:o,onFocus:c,error:i,success:d,disabled:m=!1,required:u=!1,readOnly:x=!1,className:g="",size:h="md",fullWidth:b=!0,icon:p,iconPosition:f="left",helperText:y,...j}=e,N=["block w-full border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-0 text-gray-900 placeholder-gray-500",{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-4 py-3 text-base"}[h],{default:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",error:"border-red-300 focus:border-red-500 focus:ring-red-500",success:"border-green-300 focus:border-green-500 focus:ring-green-500"}[i?"error":d?"success":"default"],m?"bg-gray-50 cursor-not-allowed text-gray-500":"bg-white",b?"w-full":"",p&&"left"===f?"pl-10":"",p&&"right"===f?"pr-10":"",g].filter(Boolean).join(" ");return(0,s.jsxs)("div",{className:"".concat(b?"w-full":""),children:[a&&(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a,u&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[p&&"left"===f&&(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400",children:p})}),(0,s.jsx)("input",{type:t,className:N,placeholder:l,value:r,onChange:n,onBlur:o,onFocus:c,disabled:m,required:u,readOnly:x,...j}),p&&"right"===f&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400",children:p})})]}),i&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i}),d&&(0,s.jsx)("p",{className:"mt-1 text-sm text-green-600",children:d}),y&&!i&&!d&&(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:y})]})}},24834:(e,t,a)=>{"use strict";function s(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function l(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(e)}function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}function n(e){return({admin:"Administrator",manager:"Manager",accountant:"Accountant",agent:"Agent"})[e]||e}function o(e){return({admin:"bg-red-100 text-red-800",manager:"bg-blue-100 text-blue-800",accountant:"bg-green-100 text-green-800",agent:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800"}a.d(t,{B9:()=>s,cb:()=>n,cn:()=>r,qP:()=>o,vv:()=>l})},34467:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(73365),l=a(24834);let r=e=>{let{children:t,className:a="",padding:r="p-6",...n}=e,o=(0,l.cn)("bg-white rounded-lg shadow-sm border border-gray-200",r,a);return(0,s.jsx)("div",{className:o,...n,children:t})};r.Header=e=>{let{children:t,className:a="",...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)("border-b border-gray-200 pb-4 mb-4",a),...r,children:t})},r.Title=e=>{let{children:t,className:a="",...r}=e;return(0,s.jsx)("h3",{className:(0,l.cn)("text-lg font-semibold text-gray-900",a),...r,children:t})},r.Content=e=>{let{children:t,className:a="",...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)("",a),...r,children:t})},r.Footer=e=>{let{children:t,className:a="",...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)("border-t border-gray-200 pt-4 mt-4",a),...r,children:t})};let n=r},41633:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(73365);a(1521);var l=a(18197),r=a.n(l);let n=e=>{let{children:t,variant:a="primary",size:l="md",disabled:n=!1,loading:o=!1,href:c,onClick:i,type:d="button",className:m="",icon:u,iconPosition:x="left",fullWidth:g=!1,...h}=e,b=["inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500",secondary:"bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500",success:"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 text-white focus:ring-yellow-500",info:"bg-blue-500 hover:bg-blue-600 text-white focus:ring-blue-400",outline:"border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 focus:ring-gray-500",ghost:"bg-transparent hover:bg-gray-100 text-gray-700 focus:ring-gray-500"}[a],{xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base",xl:"px-8 py-4 text-lg"}[l],g?"w-full":"",m].filter(Boolean).join(" "),p=(0,s.jsxs)(s.Fragment,{children:[o&&(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!o&&u&&"left"===x&&(0,s.jsx)("span",{className:"mr-2",children:u}),t,!o&&u&&"right"===x&&(0,s.jsx)("span",{className:"ml-2",children:u})]});return c?(0,s.jsx)(r(),{href:c,className:b,...h,children:p}):(0,s.jsx)("button",{type:d,className:b,disabled:n||o,onClick:i,...h,children:p})}},57353:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(73365),l=a(1521);let r=e=>{let{options:t=[],value:a,onChange:r,placeholder:n="Select an option",searchable:o=!1,loading:c=!1,disabled:i=!1,error:d=!1,onSearch:m=null,displayKey:u="label",valueKey:x="value",className:g=""}=e,[h,b]=(0,l.useState)(!1),[p,f]=(0,l.useState)(""),y=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&(b(!1),f(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let j=o&&p?t.filter(e=>e[u].toLowerCase().includes(p.toLowerCase())):t;return(0,s.jsxs)("div",{className:"relative ".concat(g),ref:y,children:[(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),!i&&(b(!h),h||f(""))},disabled:i,className:"\n          w-full px-3 py-2.5 text-left border rounded-lg shadow-sm bg-white text-gray-900\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed\n          ".concat(d?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300","\n          ").concat(h?"ring-2 ring-blue-500 border-blue-500":"","\n        "),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"".concat(a?"text-gray-900":"text-gray-500"," truncate text-sm flex-1 min-w-0"),children:(()=>{let e=t.find(e=>e[x]===a);return e?e[u]:n})()}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(h?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),h&&(0,s.jsxs)("div",{className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden",children:[o&&(0,s.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,s.jsx)("input",{type:"text",value:p,onChange:e=>{let t=e.target.value;f(t),m&&m(t)},placeholder:"Search...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})}),(0,s.jsx)("div",{className:"max-h-48 overflow-y-auto",children:c?(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Loading..."}):0===j.length?(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:p?"No options found":"No options available"}):j.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:t=>((e,t)=>{t.preventDefault(),t.stopPropagation(),r&&"function"==typeof r&&r(e[x]),b(!1),f("")})(e,t),className:"\n                    w-full px-3 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none cursor-pointer\n                    ".concat(e[x]===a?"bg-blue-50 text-blue-900":"text-gray-900","\n                  "),children:e[u]},e[x]||t))})]})]})}}},e=>{e.O(0,[96,358],()=>e(e.s=20900)),_N_E=e.O()}]);