(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{21071:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(73365);a(1521);let s=e=>{let{type:t="text",label:a,placeholder:s,value:l,onChange:n,onBlur:o,onFocus:c,error:i,success:d,disabled:u=!1,required:m=!1,readOnly:x=!1,className:g="",size:p="md",fullWidth:b=!0,icon:h,iconPosition:y="left",helperText:v,...f}=e,j=["block w-full border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-0 text-gray-900 placeholder-gray-500",{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-4 py-3 text-base"}[p],{default:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",error:"border-red-300 focus:border-red-500 focus:ring-red-500",success:"border-green-300 focus:border-green-500 focus:ring-green-500"}[i?"error":d?"success":"default"],u?"bg-gray-50 cursor-not-allowed text-gray-500":"bg-white",b?"w-full":"",h&&"left"===y?"pl-10":"",h&&"right"===y?"pr-10":"",g].filter(Boolean).join(" ");return(0,r.jsxs)("div",{className:"".concat(b?"w-full":""),children:[a&&(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a,m&&(0,r.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[h&&"left"===y&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("span",{className:"text-gray-400",children:h})}),(0,r.jsx)("input",{type:t,className:j,placeholder:s,value:l,onChange:n,onBlur:o,onFocus:c,disabled:u,required:m,readOnly:x,...f}),h&&"right"===y&&(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,r.jsx)("span",{className:"text-gray-400",children:h})})]}),i&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i}),d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-green-600",children:d}),v&&!i&&!d&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:v})]})}},33605:(e,t,a)=>{Promise.resolve().then(a.bind(a,67540))},57353:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(73365),s=a(1521);let l=e=>{let{options:t=[],value:a,onChange:l,placeholder:n="Select an option",searchable:o=!1,loading:c=!1,disabled:i=!1,error:d=!1,onSearch:u=null,displayKey:m="label",valueKey:x="value",className:g=""}=e,[p,b]=(0,s.useState)(!1),[h,y]=(0,s.useState)(""),v=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{v.current&&!v.current.contains(e.target)&&(b(!1),y(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=o&&h?t.filter(e=>e[m].toLowerCase().includes(h.toLowerCase())):t;return(0,r.jsxs)("div",{className:"relative ".concat(g),ref:v,children:[(0,r.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),!i&&(b(!p),p||y(""))},disabled:i,className:"\n          w-full px-3 py-2.5 text-left border rounded-lg shadow-sm bg-white text-gray-900\n          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n          disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed\n          ".concat(d?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300","\n          ").concat(p?"ring-2 ring-blue-500 border-blue-500":"","\n        "),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"".concat(a?"text-gray-900":"text-gray-500"," truncate text-sm flex-1 min-w-0"),children:(()=>{let e=t.find(e=>e[x]===a);return e?e[m]:n})()}),(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(p?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),p&&(0,r.jsxs)("div",{className:"absolute z-[9999] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden",children:[o&&(0,r.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,r.jsx)("input",{type:"text",value:h,onChange:e=>{let t=e.target.value;y(t),u&&u(t)},placeholder:"Search...",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",autoFocus:!0})}),(0,r.jsx)("div",{className:"max-h-48 overflow-y-auto",children:c?(0,r.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Loading..."}):0===f.length?(0,r.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500",children:h?"No options found":"No options available"}):f.map((e,t)=>(0,r.jsx)("button",{type:"button",onClick:t=>((e,t)=>{t.preventDefault(),t.stopPropagation(),l&&"function"==typeof l&&l(e[x]),b(!1),y("")})(e,t),className:"\n                    w-full px-3 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none cursor-pointer\n                    ".concat(e[x]===a?"bg-blue-50 text-blue-900":"text-gray-900","\n                  "),children:e[m]},e[x]||t))})]})]})}},67540:(e,t,a)=>{"use strict";a.d(t,{default:()=>u});var r=a(73365),s=a(1521),l=a(41633),n=a(21071),o=a(57353),c=a(34467),i=a(64427);let d=["dosa","idli","chapati","parata","paneer","green peas"];function u(){let[e,t]=(0,s.useState)({date:new Date().toISOString().split("T")[0],againstPurchaseId:"",vendorName:"",companyId:"PRIMA-SM",discount:0}),[a,u]=(0,s.useState)([{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}]),[m,x]=(0,s.useState)([]),[g,p]=(0,s.useState)([{value:"PRIMA-SM",label:"PRIMA Sales & Marketing"},{value:"PRIMA-FT",label:"PRIMA Food Trading"},{value:"PRIMA-EX",label:"PRIMA Export"}]),[b,h]=(0,s.useState)([]),[y,v]=(0,s.useState)({taxableValue:0,gst:0,invoiceValue:0,total:0}),[f,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(!1),[I,S]=(0,s.useState)("");(0,s.useEffect)(()=>{k(),A()},[e.companyId]),(0,s.useEffect)(()=>{let t=0,r=0,s=0;a.forEach(e=>{t+=e.taxableValue||0,r+=e.gst||0,s+=e.invoiceValue||0});let l=parseFloat(e.discount)||0,n=s-l;v({taxableValue:t,gst:r,invoiceValue:s,total:n})},[a,e.discount]);let k=async()=>{try{let t=await fetch("/api/vendors?company=".concat(e.companyId));if(t.ok){let e=await t.json();x((e.vendors||[]).map(e=>({value:e.vendorName,label:"".concat(e.vendorName," - ").concat(e.contactPerson)})))}}catch(e){console.error("Error fetching vendors:",e)}},A=async()=>{try{let t=await fetch("/api/purchases?company=".concat(e.companyId,"&type=Purchase&limit=100"));if(t.ok){let e=await t.json();h(e.purchases.map(e=>({value:e._id,label:"".concat(e.purchaseNumber," - ").concat(e.vendorName," (").concat(new Date(e.date).toLocaleDateString(),")")})))}}catch(e){console.error("Error fetching purchases:",e)}},V=(e,a)=>{t(t=>({...t,[e]:a}))},C=async e=>{if(t(t=>({...t,againstPurchaseId:e})),e)try{let a=await fetch("/api/purchases/".concat(e));if(a.ok){let e=await a.json();j(e),t(t=>({...t,vendorName:e.vendorName,companyId:e.companyId}));let r=e.items.map(e=>({product:e.product.toLowerCase(),expiryDate:new Date(e.expiryDate).toISOString().split("T")[0],qty:e.qty.toString(),rate:e.rate.toString(),taxableValue:e.taxableValue,gst:e.gst,invoiceValue:e.invoiceValue}));u(r)}}catch(e){console.error("Error fetching purchase details:",e)}else j(null),u([{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}])},P=(e,t,r)=>{let s=[...a];if(s[e]={...s[e],[t]:r},"qty"===t||"rate"===t){let t=parseFloat(s[e].qty)||0,a=parseFloat(s[e].rate)||0,r=s[e].product;if(r&&t&&a){let l=(0,i.$Q)(r,t,a,0);s[e]={...s[e],taxableValue:l.taxableValue,gst:l.gst,invoiceValue:l.invoiceValue}}}u(s)},D=async r=>{r.preventDefault(),w(!0),S("");try{let r={againstPurchaseId:e.againstPurchaseId,vendorName:e.vendorName,companyId:e.companyId,items:a.map(e=>{var t;return{product:e.product.toLowerCase(),expiryDate:e.expiryDate,qty:parseFloat(e.qty),rate:parseFloat(e.rate),unit:e.unit,hsnCode:(null==(t=getProductDetails(e.product))?void 0:t.hsnCode)||""}}),discount:parseFloat(e.discount)||0},s=await fetch("/api/purchases/returns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(s.ok)await s.json(),alert("Purchase return created successfully!"),t({date:new Date().toISOString().split("T")[0],againstPurchaseId:"",vendorName:"",companyId:"PRIMA-SM",discount:0}),u([{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}]),v({taxableValue:0,gst:0,invoiceValue:0,total:0}),j(null);else{let e=await s.json();S(e.error||"Failed to create purchase return")}}catch(e){console.error("Error creating purchase return:",e),S("Failed to create purchase return")}finally{w(!1)}};return(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)(c.A,{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Create Purchase Return"}),I&&(0,r.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-red-600",children:I})}),(0,r.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Return Number"}),(0,r.jsx)(n.A,{value:"Auto-generated",disabled:!0,className:"bg-gray-50"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,r.jsx)(n.A,{type:"date",value:e.date,onChange:e=>V("date",e.target.value),required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Against Purchase Order"}),(0,r.jsx)(o.A,{options:b,value:e.againstPurchaseId,onChange:C,placeholder:"Select original purchase...",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name"}),(0,r.jsx)(o.A,{options:g,value:e.companyId,onChange:e=>V("companyId",e),required:!0})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor Name"}),(0,r.jsx)(o.A,{options:m,value:e.vendorName,onChange:e=>V("vendorName",e),placeholder:"Select supplier...",searchable:!0,required:!0})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Items"}),(0,r.jsx)(l.A,{type:"button",onClick:()=>{u([...a,{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}])},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2",children:"+ Add Item"})]}),a.map((e,t)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-700",children:["Item ",t+1]}),a.length>1&&(0,r.jsx)(l.A,{type:"button",onClick:()=>{a.length>1&&u(a.filter((e,a)=>a!==t))},className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 text-sm",children:"Remove"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),(0,r.jsx)(o.A,{options:d.map(e=>({value:e,label:e})),value:e.product,onChange:e=>P(t,"product",e),placeholder:"Select product...",searchable:!0,required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date"}),(0,r.jsx)(n.A,{type:"date",value:e.expiryDate,onChange:e=>P(t,"expiryDate",e.target.value),required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),(0,r.jsx)(n.A,{type:"number",value:e.qty,onChange:e=>P(t,"qty",e.target.value),placeholder:"Enter return quantity",min:"0",step:"0.01",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),(0,r.jsx)(n.A,{type:"number",value:e.rate,onChange:e=>P(t,"rate",e.target.value),placeholder:"Enter rate per unit",min:"0",step:"0.01",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Taxable Value"}),(0,r.jsx)(n.A,{value:"₹".concat(e.taxableValue.toFixed(2)),disabled:!0,className:"bg-gray-50"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"GST"}),(0,r.jsx)(n.A,{value:"₹".concat(e.gst.toFixed(2)),disabled:!0,className:"bg-gray-50"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Value"}),(0,r.jsx)(n.A,{value:"₹".concat(e.invoiceValue.toFixed(2)),disabled:!0,className:"bg-gray-50"})]})]})]},t))]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount"}),(0,r.jsx)(n.A,{type:"number",value:e.discount,onChange:e=>V("discount",e.target.value),placeholder:"Enter discount amount",min:"0",step:"0.01"})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total"}),(0,r.jsx)(n.A,{value:"₹".concat(y.total.toFixed(2)),disabled:!0,className:"bg-red-50 border-red-200 text-red-800 font-semibold"})]})}),(0,r.jsxs)("div",{className:"flex gap-4 pt-6",children:[(0,r.jsx)(l.A,{type:"submit",disabled:N,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3",children:N?"Creating...":"Create Purchase Return"}),(0,r.jsx)(l.A,{type:"button",variant:"secondary",onClick:()=>{t({date:new Date().toISOString().split("T")[0],againstPurchaseId:"",vendorName:"",companyId:"PRIMA-SM",discount:0}),u([{product:"",expiryDate:"",qty:"",rate:"",taxableValue:0,gst:0,invoiceValue:0}]),j(null)},className:"px-6 py-3",children:"Reset Form"})]})]})]})})}}},e=>{e.O(0,[96,541,358],()=>e(e.s=33605)),_N_E=e.O()}]);